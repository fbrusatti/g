  /*********
    DATE-TIME-PICKER
    **********/
$(document).ready(function(){
  $('.appointment_date_time_picker').datetimepicker({
    language: 'es',
    maskInput: true,
    pick12HourFormat: true,
    format: 'dd/MM/yyyy hh:mm',
    startDate: new Date(),
    endDate: Infinity
  });

  $("a.appointment-save").click(function() {
    $("#new_appointment, [id^=edit_appointment_]").submit();
  });
})

  /*********
    TOKEN- INPUT : to customer and property
    **********/

$(function () {

  $('#appointment_customer_tokens').tokenInput('/customers.json', {
    crossDomain: false,
    prePopulate: $('#appointment_customer_tokens').data('pre'),
    theme: "facebook",
    tokenLimit: "1",
    noResultsText: "<%= I18n.t('.token_input.noResultsText') %>",
    hintText: "<%= I18n.t('.token_input.hintText')%>",
    searchingText: "<%= I18n.t('.token_input.searchingText')%>",
    resultsFormatter: function(item){
      return "<li><p style='color: black' >" + item.name
      + " " + item.surname + " (" + item.dni + ") </p> </li>" },
    tokenFormatter: function(item) {
      return "<li><p>" + item.name + " " + item.surname +
      " (" + item.dni + ") </p> </li>" }
  });

  $('#appointment_property_tokens').tokenInput('/properties.json', {
    crossDomain: false,
    prePopulate: $('#appointment_property_tokens').data('pre'),
    theme: "facebook",
    propertyToSearch: "address",
    tokenLimit: "1",
    noResultsText: "<%= I18n.t('.token_input.noResultsText') %>",
    hintText: "<%= I18n.t('.token_input.hintText')%>",
    searchingText: "<%= I18n.t('.token_input.searchingText')%>",
     resultsFormatter: function(item){
      return "<li><p style='color: black' >" + item.address
      + " (" + item.id + ") </p> </li>" },
     tokenFormatter: function(item) {
       return "<li><p>" + item.address +
       " (" + item.id + ") </p> </li>" }
  });
});


  /*********
    DATA-TABLE
    **********/

  // function principal to show
  // ---------------------------

  $(document).ready(function() {
    var dateType;


    var oTable = $('#appointments').dataTable({
      sPaginationType: "full_numbers",
      bJQueryUI: true,
      bProcessing: true,
      bServerSide: true,

      "aaSorting": [[ 4, "desc" ]],
      aoColumns: [
      { "sWidth": "35%" },
      { "sWidth": "5%" },
      { "sWidth": "5%", "sClass": "center"},
      { "sWidth": "5%", "sClass": "center"},
      { "sWidth": "10%", "sClass": "center"},
      { "sWidth": "5%", "sClass": "center"},
      { "sWidth": "15%"},
      { "sWidth": "20%"}
      ],
      // "sDom": "Rlfrtip",
      sAjaxSource: $('#appointments').data('source'),
      "fnInitComplete": function(oSettings, json) {

        /* Add a select menu for each TH element in the table footer */
        $("thead th").each( function ( i ) {
            $('select', this).change( function () {

              oTable.fnFilter( $(this).val(),i);
             } );

        } );
        $("a.appointment-today").click(function() {
          dateType="today";
          oTable.fnFilter("");
        });
        $("a.appointment-week").click(function() {
           dateType="week";
           oTable.fnFilter("");
        });
        $("a.appointment-month").click(function() {
           dateType="month";
           oTable.fnFilter("");
        });
        $("a.appointment-all").click(function() {
           dateType= null;
           oTable.fnFilter("");
        });
      },

      "fnServerData": function ( sSource, aoData, fnCallback ) {

         aoData.push( { "name": "dateType", "value": dateType });

         $.getJSON( sSource, aoData, function (json) {
           /* Do whatever additional processing you want on the callback, then tell DataTables */
            fnCallback(json)
         } );
     }
  });

 });
