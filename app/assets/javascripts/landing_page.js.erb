$(document).ready(function() {

  $('input[name="daterange"]').daterangepicker();
    /*********
    DATA-TABLE
    **********/

  // function principal to show
  // ---------------------------
  var oTablelp, bMyProperties;
  bMyProperties = false;
  oTablelp = $('#lastest-changes').dataTable({
    sPaginationType: "full_numbers",
    bJQueryUI: true,
    bProcessing: true,
    bServerSide: true,
    sAjaxSource: $('#lastest-changes').data('source'),
    bAutoWidth: false,
    oLanguage: { sUrl: "/datatables/spanish.txt" },
    aaSorting: [[ 2, "desc" ]],
    aoColumns: [
      { "sWidth": "45%", "bSearchable": false },
      { "sWidth": "10%", "sClass": "center", "bSearchable": true },
      { "sWidth": "10%", "bSearchable": true }
    ],
    fnInitComplete: function(oSettings, json) {
      /* Add a select menu for each TH element in the table footer */
      var column = 2;
      $('button').click( function () {
        start = $('input[name="daterangepicker_start"]').val();
        end = $('input[name="daterangepicker_end"]').val();
        oTablelp.fnFilter(start+" "+end, column);
      });
      $('.ranges ul > li').click( function () {
        start = $('input[name="daterangepicker_start"]').val();
        end = $('input[name="daterangepicker_end"]').val();
        oTablelp.fnFilter(start+" "+end, column);
      });
      $("thead th").each( function ( i ) {
        $('select', this).change( function () {
          oTablelp.fnFilter( $(this).val(),i);
         });
      });
    }

  });

  // row select
  // ----------
  var giRedraw = false
  // Add a click handler to the rows - this could be used as a callback
  $("#lastest-changes tbody").click(function(event) {
    $(oTablelp.fnSettings().aoData).each(function (){
      $(this.nTr).removeClass('row_selected');
    });
    $(event.target.parentNode).addClass('row_selected');
  });
  // Add a click handler for the delete row
  $('#delete').click( function() {
    var anSelected = fnGetSelected( oTablelp );
    oTablelp.fnDeleteRow( anSelected[0] );
  } );
  // Init the table
  oTablelp = $('#lastest-changes').dataTable( );

});// END-$(document)

  /*********
  DATA-TABLE
  **********/

// Get the rows which are currently selected
function fnGetSelected( oTableLocal )
{
  var aReturn = new Array();
  var aTrs = oTableLocal.fnGetNodes();

  for ( var i=0 ; i<aTrs.length ; i++ )
  {
    if ( $(aTrs[i]).hasClass('row_selected') )
    {
      aReturn.push( aTrs[i] );
    }
  }
  return aReturn;
}
